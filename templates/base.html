<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Trivanta Edge ERP{% endblock %}</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    
    <!-- HTMX for dynamic content -->
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    
    <!-- Alpine.js for reactive components -->
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    
    <!-- Firebase Configuration -->
    <script type="module">
      // Import the functions you need from the SDKs you need
      import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
      import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-analytics.js";
      import { getFirestore, collection, addDoc, getDocs, doc, updateDoc, deleteDoc, onSnapshot, query, where, orderBy } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js";
      import { getStorage, ref, uploadBytes, getDownloadURL, deleteObject } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-storage.js";

      // Your web app's Firebase configuration
      const firebaseConfig = {
        apiKey: "AIzaSyBwceYbtCryrZcTYvK38GtUNjEnvTVfqXQ",
        authDomain: "trivanta-erp.firebaseapp.com",
        projectId: "trivanta-erp",
        storageBucket: "trivanta-erp.firebasestorage.app",
        messagingSenderId: "1086746404611",
        appId: "1:1086746404611:web:f1b58ca02ab6496cc46b36",
        measurementId: "G-7NG8G150T9"
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const analytics = getAnalytics(app);
      const db = getFirestore(app);
      const storage = getStorage(app);

      // Make Firebase available globally
      window.firebase = {
        app,
        analytics,
        db,
        storage,
        firestore: {
          collection,
          addDoc,
          getDocs,
          doc,
          updateDoc,
          deleteDoc,
          onSnapshot,
          query,
          where,
          orderBy
        },
        storage: {
          ref,
          uploadBytes,
          getDownloadURL,
          deleteObject
        }
      };
    </script>
    
    <!-- Custom CSS -->
    <style>
        /* Basic fallback styles */
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f8fafc;
            color: #333;
        }
        
        /* Ensure content is visible */
        .min-h-screen { min-height: 100vh; }
        .flex { display: flex; }
        .items-center { align-items: center; }
        .justify-center { justify-content: center; }
        .bg-gray-50 { background-color: #f9fafb; }
        .py-12 { padding: 3rem 0; }
        .px-4 { padding: 0 1rem; }
        .max-w-md { max-width: 28rem; }
        .w-full { width: 100%; }
        .mx-auto { margin: 0 auto; }
        .text-center { text-align: center; }
        
        /* Form elements */
        input, button {
            font-family: inherit;
            font-size: 16px;
        }
        
        input[type="email"], input[type="password"] {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            margin-bottom: 10px;
        }
        
        button[type="submit"] {
            width: 100%;
            padding: 10px 16px;
            background-color: #2563eb;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
        }
        
        button[type="submit"]:hover {
            background-color: #1d4ed8;
        }
        
        /* Custom color palette */
        :root {
            --primary-blue: #1e3a8a;
            --secondary-blue: #3b82f6;
            --light-gray: #f8fafc;
            --medium-gray: #64748b;
            --white: #ffffff;
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--light-gray);
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--medium-gray);
            border-radius: 3px;
        }
        
        /* Professional animations */
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Card hover effects */
        .card-hover {
            transition: all 0.2s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        /* Custom button styles */
        .btn-custom-primary {
            background-color: var(--primary-blue);
            border-color: var(--primary-blue);
        }
        
        .btn-custom-primary:hover {
            background-color: var(--secondary-blue);
            border-color: var(--secondary-blue);
        }
        
        /* Custom table styles */
        .table-custom th {
            background-color: var(--light-gray);
            border-bottom: 2px solid var(--medium-gray);
            font-weight: 600;
        }
        
        .table-custom td {
            vertical-align: middle;
        }
        
        /* Custom form styles */
        .form-control:focus {
            border-color: var(--secondary-blue);
            box-shadow: 0 0 0 0.2rem rgba(59, 130, 246, 0.25);
        }
        
        /* Custom badge styles */
        .badge-custom {
            font-size: 0.75rem;
            padding: 0.375rem 0.75rem;
        }
        
        /* Custom modal styles */
        .modal-header {
            background-color: var(--light-gray);
            border-bottom: 1px solid var(--medium-gray);
        }
        
        /* Custom navigation styles */
        .navbar-custom {
            background-color: var(--white);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .navbar-custom .navbar-brand {
            color: var(--primary-blue);
            font-weight: 700;
        }
        
        .navbar-custom .nav-link {
            color: var(--medium-gray);
            font-weight: 500;
        }
        
        .navbar-custom .nav-link:hover {
            color: var(--primary-blue);
        }
        
        /* Custom sidebar styles */
        .sidebar {
            background-color: var(--white);
            border-right: 1px solid var(--light-gray);
            min-height: 100vh;
        }
        
        /* Custom card styles */
        .card-custom {
            border: 1px solid var(--light-gray);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            transition: all 0.2s ease;
        }
        
        .card-custom:hover {
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        /* Custom alert styles */
        .alert-custom {
            border-radius: 0.5rem;
            border: none;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        
        /* Custom dropdown styles */
        .dropdown-menu-custom {
            border: 1px solid var(--light-gray);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border-radius: 0.5rem;
        }
        
        /* Custom pagination styles */
        .pagination-custom .page-link {
            color: var(--primary-blue);
            border-color: var(--light-gray);
        }
        
        .pagination-custom .page-link:hover {
            background-color: var(--light-gray);
            border-color: var(--primary-blue);
        }
        
        .pagination-custom .page-item.active .page-link {
            background-color: var(--primary-blue);
            border-color: var(--primary-blue);
        }
    </style>
    
    {% block extra_css %}{% endblock %}
</head>
<body class="bg-light">
    <!-- Navigation -->
    {% if session.user_id %}
    <nav class="navbar navbar-expand-lg navbar-custom">
        <div class="container-fluid">
            <!-- Logo and Brand -->
            <a class="navbar-brand" href="#">
                <i class="bi bi-building me-2"></i>
                Trivanta Edge ERP
            </a>
            
            <!-- Mobile Toggle -->
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <!-- Navigation Links -->
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    {% if session.role == 'admin' %}
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('admin.dashboard') }}">
                                <i class="bi bi-speedometer2 me-1"></i>Dashboard
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('admin.users') }}">
                                <i class="bi bi-people me-1"></i>Users
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('admin.clients') }}">
                                <i class="bi bi-person-badge me-1"></i>Clients
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('admin.projects') }}">
                                <i class="bi bi-kanban me-1"></i>Projects
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('admin.tasks') }}">
                                <i class="bi bi-list-task me-1"></i>Tasks
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('admin.leads') }}">
                                <i class="bi bi-funnel me-1"></i>Leads
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('admin.attendance') }}">
                                <i class="bi bi-calendar-check me-1"></i>Attendance
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('admin.analytics') }}">
                                <i class="bi bi-graph-up me-1"></i>Analytics
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('admin.reports') }}">
                                <i class="bi bi-file-earmark-text me-1"></i>Reports
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('admin.settings') }}">
                                <i class="bi bi-gear me-1"></i>Settings
                            </a>
                        </li>
                    {% elif session.role == 'manager' %}
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('manager.dashboard') }}">
                                <i class="bi bi-speedometer2 me-1"></i>Dashboard
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('manager.employees') }}">
                                <i class="bi bi-people me-1"></i>Employees
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('manager.projects') }}">
                                <i class="bi bi-kanban me-1"></i>Projects
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('manager.clients') }}">
                                <i class="bi bi-person-badge me-1"></i>Clients
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('manager.leads') }}">
                                <i class="bi bi-funnel me-1"></i>Leads
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('manager.attendance') }}">
                                <i class="bi bi-calendar-check me-1"></i>Attendance
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('manager.analytics') }}">
                                <i class="bi bi-graph-up me-1"></i>Analytics
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('manager.tasks') }}">
                                <i class="bi bi-list-task me-1"></i>Tasks
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('manager.inventory') }}">
                                <i class="bi bi-box-seam me-1"></i>Inventory
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('manager.reports') }}">
                                <i class="bi bi-file-earmark-text me-1"></i>Reports
                            </a>
                        </li>
                    {% elif session.role == 'employee' %}
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('employee.dashboard') }}">
                                <i class="bi bi-speedometer2 me-1"></i>Dashboard
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('employee.attendance') }}">
                                <i class="bi bi-calendar-check me-1"></i>Attendance
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('employee.projects') }}">
                                <i class="bi bi-kanban me-1"></i>Projects
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('employee.leads') }}">
                                <i class="bi bi-funnel me-1"></i>Leads
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('employee.clients') }}">
                                <i class="bi bi-person-badge me-1"></i>Clients
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('employee.tasks') }}">
                                <i class="bi bi-list-task me-1"></i>Tasks
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('employee.profile') }}">
                                <i class="bi bi-person me-1"></i>Profile
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('employee.reports') }}">
                                <i class="bi bi-file-earmark-text me-1"></i>Reports
                            </a>
                        </li>
                    {% endif %}
                </ul>
                
                <!-- User Menu -->
                <ul class="navbar-nav">
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                            <i class="bi bi-person-circle me-1"></i>{{ session.name }}
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><span class="dropdown-item-text">
                                <small class="text-muted">Role</small><br>
                                <span class="badge bg-primary">{{ session.role|title }}</span>
                            </span></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="{% if session.role == 'admin' %}{{ url_for('admin.users') }}{% elif session.role == 'manager' %}{{ url_for('manager.employees') }}{% else %}{{ url_for('employee.profile') }}{% endif %}">
                                <i class="bi bi-person me-2"></i>Profile
                            </a></li>
                            <li><a class="dropdown-item" href="{% if session.role == 'admin' %}{{ url_for('admin.settings') }}{% elif session.role == 'manager' %}{{ url_for('manager.reports') }}{% else %}{{ url_for('employee.reports') }}{% endif %}">
                                <i class="bi bi-gear me-2"></i>Settings
                            </a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item text-danger" href="{{ url_for('logout') }}">
                                <i class="bi bi-box-arrow-right me-2"></i>Logout
                            </a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    {% endif %}
    
    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="container-fluid mt-3">
                {% for category, message in messages %}
                    <div class="alert alert-{{ 'danger' if category == 'error' else 'success' if category == 'success' else 'info' }} alert-dismissible fade show fade-in" role="alert">
                        <i class="bi bi-{{ 'exclamation-triangle' if category == 'error' else 'check-circle' if category == 'success' else 'info-circle' }} me-2"></i>
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}
    
    <!-- Main Content -->
    <main class="container-fluid py-4">
        {% block content %}{% endblock %}
    </main>
    
    <!-- Footer -->
    <footer class="bg-white border-top mt-5">
        <div class="container-fluid py-4">
            <div class="text-center text-muted">
                <p class="mb-0">&copy; 2024 Trivanta Edge ERP. All rights reserved.</p>
            </div>
        </div>
    </footer>
    
    <!-- Bootstrap JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- jQuery (for some existing functionality) -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    
    <!-- Custom JavaScript -->
    <script>
        // Auto-hide flash messages after 5 seconds
        document.addEventListener('DOMContentLoaded', function() {
            const flashMessages = document.querySelectorAll('.fade-in');
            flashMessages.forEach(function(message) {
                setTimeout(function() {
                    message.style.opacity = '0';
                    setTimeout(function() {
                        message.remove();
                    }, 300);
                }, 5000);
            });
        });
        
        // HTMX loading states
        document.body.addEventListener('htmx:beforeRequest', function(evt) {
            const target = evt.target;
            if (target.tagName === 'BUTTON') {
                target.disabled = true;
                const originalText = target.innerHTML;
                target.setAttribute('data-original-text', originalText);
                target.innerHTML = '<span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>Loading...';
            }
        });
        
        document.body.addEventListener('htmx:afterRequest', function(evt) {
            const target = evt.target;
            if (target.tagName === 'BUTTON') {
                target.disabled = false;
                const originalText = target.getAttribute('data-original-text');
                if (originalText) {
                    target.innerHTML = originalText;
                }
            }
        });
        
        // Initialize tooltips
        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
        var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl);
        });
        
        // Initialize popovers
        var popoverTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]'));
        var popoverList = popoverTriggerList.map(function (popoverTriggerEl) {
            return new bootstrap.Popover(popoverTriggerEl);
        });
    </script>
    
    {% block extra_js %}{% endblock %}
</body>
</html>
